import { GetFormSchema } from "components/SpruceForm";
import widgets from "components/SpruceForm/Widgets";
import { ProjectType } from "../utils";

export const getFormSchema = (
  projectType: ProjectType,
): ReturnType<GetFormSchema> => ({
  fields: {},
  schema: {
    definitions: {
      filterArray: {
        title: "",
        type: "array" as const,
        default: [],
        items: {
          type: "object" as const,
          properties: {
            expression: {
              type: "string" as const,
              title: "Filter Expression",
              default: "",
              minLength: 1,
              format: "validRegex",
            },
            description: {
              type: "string" as const,
              title: "Description",
              default: "",
            },
            caseSensitive: {
              type: "boolean" as const,
              title: "Case",
              default: false,
              oneOf: [
                {
                  type: "boolean" as const,
                  title: "Insensitive",
                  enum: [false],
                },
                {
                  type: "boolean" as const,
                  title: "Sensitive",
                  enum: [true],
                },
              ],
            },
            exactMatch: {
              type: "boolean" as const,
              title: "Match",
              default: true,
              oneOf: [
                {
                  type: "boolean" as const,
                  title: "Exact",
                  enum: [true],
                },
                {
                  type: "boolean" as const,
                  title: "Inverse",
                  enum: [false],
                },
              ],
            },
          },
        },
      },
    },
    type: "object" as const,
    properties: {
      parsleyFiltersTitle: {
        type: "null",
        title: "Parsley Filters",
      },
      parsleyFilters: { $ref: "#/definitions/filterArray" },
      ...(projectType === ProjectType.AttachedProject && {
        repoData: {
          type: "object" as const,
          title: "Repo Filters",
          properties: {
            parsleyFilters: { $ref: "#/definitions/filterArray" },
          },
        },
      }),
    },
  },
  uiSchema: {
    parsleyFiltersTitle: {
      "ui:sectionTitle": true,
    },
    parsleyFilters: {
      "ui:addButtonText": "Add filter",
      "ui:orderable": false,
      "ui:description":
        "These filters will be available by default in the Parsley log viewer for any logs generated by this project.",
      "ui:useExpandableCard": true,
      "ui:data-cy": "parsley-filter-list",
      items: {
        "ui:displayTitle": "New Parsley Filter",
        "ui:label": false,
        expression: {
          "ui:data-cy": "parsley-filter-expression",
        },
        caseSensitive: {
          "ui:widget": widgets.SegmentedControlWidget,
          "ui:aria-controls": ["case-insensitive", "case-sensitive"],
          "ui:data-cy": "parsley-filter-case-sensitivity",
          "ui:sizeVariant": "xsmall",
        },
        exactMatch: {
          "ui:widget": widgets.SegmentedControlWidget,
          "ui:aria-controls": ["exact-match", "inverse-match"],
          "ui:data-cy": "parsley-filter-match-type",
          "ui:sizeVariant": "xsmall",
        },
      },
    },
    repoData: {
      parsleyFilters: {
        "ui:fullWidth": true,
        "ui:placeholder": "Repo has no filters defined.",
        "ui:readonly": true,
        "ui:showLabel": false,
        "ui:useExpandableCard": true,
        items: {
          caseSensitive: {
            "ui:widget": widgets.SegmentedControlWidget,
            "ui:sizeVariant": "xsmall",
          },
          exactMatch: {
            "ui:widget": widgets.SegmentedControlWidget,
            "ui:sizeVariant": "xsmall",
          },
        },
      },
    },
  },
});
