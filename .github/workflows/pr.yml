name: "Pull Request Checks"
on: pull_request
jobs:
  chromatic:
    name: Chromatic Tests
    runs-on: ubuntu-latest
    steps:
      - name: Check access
        if: ${{ github.event.pull_request.author_association != 'CONTRIBUTOR' && github.event.pull_request.author_association != 'MEMBER' }}
        run: |
          echo "Event not triggered by a collaborator."
          exit 1

      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Use Node 22
        uses: actions/setup-node@v4
        with:
          node-version: 22.17.0
  
      - name: Install dependencies
        run: yarn install

      - name: Determine changed files
        uses: dorny/paths-filter@v3
        id: changes
        with:
          filters: |
            parsley:
              - 'apps/parsley/**'
              - 'packages/lib/**'
              - 'packages/fungi/**'
            spruce:
              - 'apps/spruce/**'
              - 'packages/lib/**'
            lib:
              - 'packages/lib/**'
            fungi:
              - 'packages/fungi/**'

      - name: Publish Chromatic (Parsley)
        if: steps.changes.outputs.parsley == 'true'
        uses: ./.github/actions/publish-chromatic-pr
        with:
          working_dir: apps/parsley
          project_token: chpt_8083ea0d9f4af30
